{% extends 'base.html' %}
{% load humanize %}

{% block content %}
  <div class="w-full max-w-6xl mx-auto px-4 mb-16">
    <div class="flex justify-between items-center mb-8 pt-6">
      {% if search_query %}
        <h2 class="text-2xl font-bold text-gray-800">
          Search Results for "{{ search_query }}"
        </h2>
      {% else %}
        <h2 class="text-2xl font-bold text-gray-800">Featured Artworks</h2>
      {% endif %}
    </div>

    <!-- Search and Filter Section -->
    <div class="bg-white rounded-lg shadow-sm mb-8 p-4">
      <form method="GET" action="{% url 'artwork_list' %}" class="space-y-4">
        <!-- Search Bar -->
        <div class="mb-4">
          <label for="search" class="block text-sm font-medium text-gray-700 mb-1">Search Artworks</label>
          <input type="text" 
                 name="search" 
                 id="search" 
                 value="{{ search_query }}"
                 placeholder="Search by title, artist, or description"
                 class="block w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Category Filter -->
          <div>
            <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
            <select name="category" id="category" class="block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md">
              <option value="">All Categories</option>
              {% for category in categories %}
                <option value="{{ category.value }}" {% if selected_category == category.value %}selected{% endif %}>
                  {{ category.label }}
                </option>
              {% endfor %}
            </select>
          </div>
          
          <!-- Price Range -->
          <div>
            <label for="price_range" class="block text-sm font-medium text-gray-700 mb-1">Price Range</label>
            <select name="price_range" id="price_range" class="block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md">
              <option value="">All Prices</option>
              <option value="0-10000" {% if price_range == '0-10000' %}selected{% endif %}>Under ₹10,000</option>
              <option value="10000-50000" {% if price_range == '10000-50000' %}selected{% endif %}>₹10,000 - ₹50,000</option>
              <option value="50000+" {% if price_range == '50000+' %}selected{% endif %}>Above ₹50,000</option>
            </select>
          </div>
          
          <!-- Sort By -->
          <div>
            <label for="sort_by" class="block text-sm font-medium text-gray-700 mb-1">Sort By</label>
            <select name="sort_by" id="sort_by" class="block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md">
              <option value="">Latest</option>
              <option value="price_low" {% if sort_by == 'price_low' %}selected{% endif %}>Price: Low to High</option>
              <option value="price_high" {% if sort_by == 'price_high' %}selected{% endif %}>Price: High to Low</option>
            </select>
          </div>
        </div>
        
        <!-- Filter Buttons -->
        <div class="flex justify-end space-x-3 pt-4">
          <a href="{% url 'artwork_list' %}" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
            Clear Filters
          </a>
          <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-gray-800 rounded-md hover:bg-gray-700">
            Apply Filters
          </button>
        </div>
      </form>
    </div>

    <!-- Results Count -->
    {% if artworks %}
      <p class="text-gray-600 mb-6">{{ artworks|length }} artwork(s) found</p>
    {% endif %}

    <!-- Artwork Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      {% for artwork in artworks %}
        <div class="bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-300">
          <a href="{% url 'artwork_detail' artwork.id %}" class="block">
            <div class="aspect-square overflow-hidden">
              <img src="{{ artwork.image.url }}" alt="{{ artwork.title }}" class="w-full h-full object-cover">
            </div>
            <div class="p-4">
              <h3 class="text-lg font-semibold text-gray-800">{{ artwork.title }}</h3>
              <p class="text-gray-600">{{ artwork.designer.username }}</p>
              <p class="text-sm text-gray-700 mt-1">{{ artwork.size }}</p>
              <div class="flex justify-between items-center mt-2">
                <p class="text-neutral-700 font-medium">₹{{ artwork.price|floatformat:2|intcomma }}</p>
                <span class="text-sm text-gray-500">{{ artwork.get_category_display }}</span>
              </div>
            </div>
          </a>
        </div>
      {% empty %}
        <div class="col-span-full text-center py-8">
          <p class="text-gray-500">No artworks found matching your criteria.</p>
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}